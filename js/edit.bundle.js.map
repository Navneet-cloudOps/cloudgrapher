{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","app/scripts/collectdata.js","edit.bundle.js","app/scripts/edit.js","app/scripts/findedges.js","app/scripts/queryparser.js","app/scripts/template.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","findEdges","collectCyData","json","knownResources","possibleEdges","edgeFilters","AWS::EC2::SecurityGroupIngress","edge","data","title","newTarget","source","target","AWS::EC2::SecurityGroupEgress","default","type","parent","get","awsType","this","nodes","edges","edgeIndex","addEdge","push","id","toResource","label","targetProperty","toProperty","resourceKey","Resources","resource","resourceClass","Type","toLowerCase","replace","CFType","nodeClass","classes","Properties","forEach","filter","./findedges",2,"refreshTimeoutID","graphArea","$","queryTools","remoteInput","showGraphBackGround","hidden","css","myCodeMirror","CodeMirror","document","getElementById","value","lineNumbers","mode","foldGutter","gutters","setSize","template","editor","setValue","getDoc","getValue","cytolib","cytoscape","graphContainer","jsonproxy","jsonp","window","getTemplate","myConfirmation","event","hasChanged","returnValue","confirm","loadTemplate","loadFn","url","templateLocation","val","embedUrl","createEmbedUrl","location","html","alertify","success","reason","setData","error","console","log","ajax","dataType","responseText","changeStyle","delayedRefresh","refreshGraph","toggle","undefined","setOption","onUpdateLinting","annotations","clearTimeout","setTimeout","addEventListener","evt","stopPropagation","preventDefault","dataTransfer","dropEffect","fromFile","files","isResizing","lastDownX","getTemplateUrl","checkValidity","hide","keypress","which","fromURL","click","change","is","show","saveAs","Blob","text","description","saveWindow","open","onload","src","base64Image","setLayout","container","editorPane","on","clientX","offsetRight","width","offset","left","fitGraph","ready","parser","search","onTemplate","./queryparser","./template",3,"findIn","start","found","Array","elem","Object","keys","fn","join","key","k","concat","apply",4,"callbacks","queryMap","URI","CFTemplateURL","host",5,"options","graph","style","initialData","collector","defaultContainer","cyto","layoutName","layouts","grid","name","fit","condense","cols","breadthfirst","directed","avoidOverlap","spacingFactor","circle","padding","radius","startAngle","Math","PI","concentric","findLayout","animate","layout","JSON","parse","indent","stringify","elements","boxSelectionEnabled","cyTarget","cloudformationType","match","onSuccess","onError","dataString","dataObject","file","fail","reader","FileReader","result","readAsText","Description","center","png","full","corsSupport","textStatus","message","status","statusText","changed","getGraph","./collectdata"],"mappings":"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","file":"edit.bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* jshint devel:true */\n/* global exports, require */\n\nvar findEdges = require('./findedges').findEdges;\n\nexports.collectCyData = function(json) {\n  'use strict';\n\n  var knownResources = {};\n  var possibleEdges = [];\n  var edgeFilters = {\n    'AWS::EC2::SecurityGroupIngress': function(edge /*, source, target*/ ) {\n      if (edge.data.title === 'GroupId') {\n        // NOOP the direction is good\n      }\n      else if (edge.data.title === 'SourceSecurityGroupId') {\n        var newTarget = edge.data.source;\n        edge.data.source = edge.data.target;\n        edge.data.target = newTarget;\n      }\n      return true;\n    },\n    'AWS::EC2::SecurityGroupEgress': function(edge /*, source, target*/ ) {\n      if (edge.data.title === 'DestinationSecurityGroupId') {\n        // NOOP the direction is good\n      }\n      else if (edge.data.title === 'GroupId') {\n        var newTarget = edge.data.source;\n        edge.data.source = edge.data.target;\n        edge.data.target = newTarget;\n      }\n      return true;\n    },\n    'default': function(edge, source, target) {\n      if (target && target.type === 'AWS::EC2::SecurityGroup' && source.type !== 'AWS::EC2::SecurityGroup') {\n        knownResources[edge.data.source].data.parent = edge.data.target;\n        return false; // Don't create an edge, security group is parent\n      }\n      return true;\n    },\n    'get': function(awsType) {\n      return this[awsType] || this['default'];\n    }\n  };\n  var data = {\n    nodes: [],\n    edges: []\n  };\n  var edgeIndex = 0;\n  var addEdge = function(edge) {\n    possibleEdges.push({\n      data: {\n        id: 'e' + (edgeIndex++),\n        source: this,\n        target: edge.toResource,\n        title: edge.label,\n        targetProperty: edge.toProperty\n      }\n    });\n  };\n\n  for (var resourceKey in json.Resources) {\n    var resource = json.Resources[resourceKey];\n    var resourceClass = resource.Type.toLowerCase().replace(/::/g, '-');\n    var r = {\n      data: {\n        id: resourceKey,\n        CFType: resource.Type,\n        nodeClass: resourceClass,\n      },\n      classes: resourceClass,\n      type: resource.Type\n    };\n    findEdges(resource.Properties).forEach(addEdge, resourceKey);\n    knownResources[resourceKey] = r;\n    data.nodes.push(r);\n  }\n\n  data.edges = possibleEdges.filter(function(edge) {\n    var source = knownResources[edge.data.source];\n    var target = knownResources[edge.data.target];\n    var filter = edgeFilters.get(source.type);\n    return edge && source && target && filter(edge, source, target);\n  });\n\n  return data;\n};\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/* jshint devel:true */\n/* global exports, require */\n\nvar findEdges = require('./findedges').findEdges;\n\nexports.collectCyData = function(json) {\n  'use strict';\n\n  var knownResources = {};\n  var possibleEdges = [];\n  var edgeFilters = {\n    'AWS::EC2::SecurityGroupIngress': function(edge /*, source, target*/ ) {\n      if (edge.data.title === 'GroupId') {\n        // NOOP the direction is good\n      }\n      else if (edge.data.title === 'SourceSecurityGroupId') {\n        var newTarget = edge.data.source;\n        edge.data.source = edge.data.target;\n        edge.data.target = newTarget;\n      }\n      return true;\n    },\n    'AWS::EC2::SecurityGroupEgress': function(edge /*, source, target*/ ) {\n      if (edge.data.title === 'DestinationSecurityGroupId') {\n        // NOOP the direction is good\n      }\n      else if (edge.data.title === 'GroupId') {\n        var newTarget = edge.data.source;\n        edge.data.source = edge.data.target;\n        edge.data.target = newTarget;\n      }\n      return true;\n    },\n    'default': function(edge, source, target) {\n      if (target && target.type === 'AWS::EC2::SecurityGroup' && source.type !== 'AWS::EC2::SecurityGroup') {\n        knownResources[edge.data.source].data.parent = edge.data.target;\n        return false; // Don't create an edge, security group is parent\n      }\n      return true;\n    },\n    'get': function(awsType) {\n      return this[awsType] || this['default'];\n    }\n  };\n  var data = {\n    nodes: [],\n    edges: []\n  };\n  var edgeIndex = 0;\n  var addEdge = function(edge) {\n    possibleEdges.push({\n      data: {\n        id: 'e' + (edgeIndex++),\n        source: this,\n        target: edge.toResource,\n        title: edge.label,\n        targetProperty: edge.toProperty\n      }\n    });\n  };\n\n  for (var resourceKey in json.Resources) {\n    var resource = json.Resources[resourceKey];\n    var resourceClass = resource.Type.toLowerCase().replace(/::/g, '-');\n    var r = {\n      data: {\n        id: resourceKey,\n        CFType: resource.Type,\n        nodeClass: resourceClass,\n      },\n      classes: resourceClass,\n      type: resource.Type\n    };\n    findEdges(resource.Properties).forEach(addEdge, resourceKey);\n    knownResources[resourceKey] = r;\n    data.nodes.push(r);\n  }\n\n  data.edges = possibleEdges.filter(function(edge) {\n    var source = knownResources[edge.data.source];\n    var target = knownResources[edge.data.target];\n    var filter = edgeFilters.get(source.type);\n    return edge && source && target && filter(edge, source, target);\n  });\n\n  return data;\n};\n\n},{\"./findedges\":3}],2:[function(require,module,exports){\n/* jshint devel:true */\n/* global saveAs, require, CodeMirror, alertify, cytoscape */\n\n(function() {\n  'use strict';\n\n  var graphArea = $('#graph_area');\n  var refreshTimeoutID;\n\n  var queryTools = require('./queryparser');\n\n  var remoteInput = $('#remote_input');\n\n  var showGraphBackGround = function (hidden) {\n    graphArea.css('background-image', !hidden ? 'url(\"images/aws-cloudformation-template.svg\")' : '');\n  };\n\n  var myCodeMirror = new CodeMirror(document.getElementById('editor'), {\n    value: '{}',\n    lineNumbers: true,\n    mode: 'application/json',\n    foldGutter: true,\n    gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter', 'CodeMirror-lint-markers'],\n\n  });\n  myCodeMirror.setSize('100%', '800px');\n\n  var template = require('./template').template({\n    'editor': {\n      setValue: function(value) { myCodeMirror.getDoc().setValue(value); },\n      getValue: function() { return myCodeMirror.getDoc().getValue(); }\n    },\n    'cytolib': cytoscape,\n    'graphContainer': graphArea[0],\n    'jsonproxy': $.jsonp\n  });\n\n  window.getTemplate = function() { return template; };\n\n  var myConfirmation = function(event) {\n    if (!template.hasChanged()) {\n      return undefined;\n    }\n    if (event && event.type === 'beforeunload') {\n      event.returnValue = 'The current template has unsaved changes.';\n      return 'The current template has unsaved changes.';\n    }\n    return window.confirm('The current template has unsaved changes. Continue loading?');\n  };\n\n  var loadTemplate = function(loadFn, url) {\n    if (!url || (template.hasChanged() && !myConfirmation())) {\n      return;\n    }\n    loadFn(\n      url,\n      function(templateLocation) {\n        showGraphBackGround(true);\n        if (typeof url === 'string') {\n          if (remoteInput.val() !== url) {\n            remoteInput.val(url);\n          }\n          var embedUrl = queryTools.createEmbedUrl(window.location, url);\n          $('#embed_link').html('Use <a href=\"' + embedUrl + '\">' + embedUrl + '</a> to open directly');\n        }\n        else {\n          remoteInput.val('');\n          $('#embed_link').html('');\n        }\n        alertify.success('Loaded template \"' + templateLocation + '\" successfully');\n      },\n      function(templateLocation, reason, e) {\n        template.setData('{\"Error\": \"Unable to load template ' + templateLocation + ' because of ' + reason + '\" }', showGraphBackGround);\n        alertify.error('Unable to load template \"' + templateLocation + '\" because of ' + reason);\n        console.log(e);\n      }\n    );\n  };\n\n  $.ajax({\n    url: 'styles/main.cycss',\n    type: 'GET',\n    dataType: 'text',\n    success: function(responseText) {\n      template.changeStyle(responseText);\n    }\n  });\n\n  var delayedRefresh = function() {\n    template.refreshGraph();\n    $('#embed_link').toggle(!template.hasChanged());\n    refreshTimeoutID = undefined;\n  };\n\n  myCodeMirror.setOption('lint', {\n    onUpdateLinting: function(annotations) {\n      if (template && (!annotations || annotations.length === 0)) {\n        if (refreshTimeoutID) {\n          window.clearTimeout(refreshTimeoutID);\n        }\n        refreshTimeoutID = window.setTimeout(delayedRefresh, 300);\n      }\n    }\n  });\n\n  graphArea[0].addEventListener('dragover', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    evt.dataTransfer.dropEffect = 'copy';\n  }, false);\n  graphArea[0].addEventListener('drop', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    loadTemplate(template.fromFile, evt.dataTransfer.files[0]);\n  }, false);\n\n\n  var isResizing = false,\n    lastDownX = 0;\n\n\n  var getTemplateUrl = function () {\n    var url = remoteInput.val();\n    if (remoteInput[0].checkValidity()){\n      remoteInput.hide();\n      return url;\n    }\n    return undefined;\n  };\n\n\n  $('#remote_input').keypress(function(e) {\n    if (e.which === 13) {\n      loadTemplate(template.fromURL, getTemplateUrl());\n      return false;\n    }\n  });\n\n  $('#open_template').click(function(event) {\n    event.preventDefault();\n    $('#template_input').click();\n  });\n  $('#template_input').change(function(event) {\n    loadTemplate(template.fromFile, event.target.files[0]);\n  });\n\n  $('#open_url').click(function(event) {\n    event.preventDefault();\n    if (remoteInput.is(':visible')) {\n      loadTemplate(template.fromURL, getTemplateUrl());\n    }\n    else {\n      remoteInput.show();\n    }\n  });\n\n  $('#save_template').click(function(event) {\n    event.preventDefault();\n    saveAs(\n      new Blob( [template.text(2)], { type: 'text/plain;charset=utf-8' }),\n      template.description() + '.json'\n    );\n    return false;\n  });\n  $('#save_graph').click(function(event) {\n    event.preventDefault();\n    var saveWindow = window.open('savegraph.html');\n    saveWindow.onload = function() {\n      saveWindow.document.getElementById('graphPNG').src = template.base64Image();\n    };\n    return false;\n  });\n  $('#graph_layout').change(function() {\n    template.setLayout($('#graph_layout').val());\n  });\n\n  var container = $('#container'),\n    editorPane = $('#editor_pane');\n\n  $('#border').on('mousedown', function(e) {\n    isResizing = true;\n    lastDownX = e.clientX;\n  });\n\n  $(document).on('mousemove', function(e) {\n    // we don't want to do anything if we aren't resizing.\n    if (!isResizing) {\n      return;\n    }\n\n    var offsetRight = container.width() - (e.clientX - container.offset().left);\n\n    graphArea.css('right', offsetRight);\n    editorPane.css('width', offsetRight);\n  }).on('mouseup', function() {\n    if (isResizing) {\n      template.fitGraph();\n    }\n    // stop resizing\n    isResizing = false;\n  });\n\n  $(document).ready(function() {\n    showGraphBackGround();\n    //----- Parse Query -----//\n    queryTools.parser(window.location.search, {\n      onTemplate: function(url) {\n        loadTemplate(template.fromURL, url);\n      }\n    });\n    //----- Parse Query -----//\n\n    window.addEventListener('beforeunload', myConfirmation);\n  });\n})();\n\n},{\"./queryparser\":4,\"./template\":5}],3:[function(require,module,exports){\n/* jshint devel:true */\n/* global exports */\n\n// findEdges/findIn\n//  - startElement element to traverse through\n//  - title        resource title to push to callback function\n// returns an array of edge objects with properties label, toResource and toProperty\n//\nexports.findEdges = function findIn (start, title) {\n  'use strict';\n  var found = [];\n  // If start is an array then let's loop through all elements to find edges\n  //\n  if (start instanceof Array) {\n    start.forEach(function(elem){\n      found.push( findIn(elem, title || '') );\n    });\n  }\n  // Else if we hit some object and we should delve into it\n  //\n  else if (typeof start === 'object') {\n    // When we only have one key then it's probably some CloudFormation function\n    // we can use to make an make edge with\n    //\n    if (Object.keys(start).length === 1) {\n      var fn = Object.keys(start)[0];\n      // If we hit a Ref, it's definitely a reference of some sorts\n      // usually we only hit this option deep and the title should be available\n      // otherwise give an empty title\n      //\n      if (fn === 'Ref' && typeof start[fn] === 'string') {\n        found.push({label: title || '', toResource: start[fn], toProperty: title || ''});\n      }\n      // An Fn::Join is trickier, we might find edges recursively\n      //\n      else if (fn === 'Fn::Join' && start[fn] instanceof Array) {\n        start[fn][1].forEach(function(elem) {\n          found.push( findIn(elem, start[fn][1].join(start[fn][0])) );\n        });\n      }\n      // If we see an Fn::GetAtt then make an edge with the reference,\n      // not the attribute\n      //\n      else if (fn === 'Fn::GetAtt' && start[fn] instanceof Array) {\n        found.push({label: title, toResource: start[fn][0], toProperty: start[fn][1]});\n      }\n      // Ok, forgot why this path is necessary, I guess it's when we didn't find\n      //  something to easily pull references from and we probably need to keep\n      //  searching anyway\n      //\n      else {\n        for (var key in start) {\n          found.push( findIn(start[key],  key) );\n        }\n      }\n    }\n    // if we have more than one key we have to delve deeper to find edges\n    //\n    else {\n      for (var k in start) {\n        found.push( findIn(start[k], k) );\n      }\n    }\n  }\n  return [].concat.apply([], found); // return a flattened array http://stackoverflow.com/a/10865042/60201\n};\n\n},{}],4:[function(require,module,exports){\n/* jshint devel:true */\n/* global exports, URI */\n\nexports.parser = function(url, callbacks) {\n    'use strict';\n    if (url) {\n        var queryMap = new URI(url).search(true);\n        if (queryMap.CFTemplateURL && callbacks.onTemplate) {\n            callbacks.onTemplate(queryMap.CFTemplateURL);\n        }\n    }\n};\n\nexports.createEmbedUrl = function(host, target) {\n    'use strict';\n    return new URI(host).search(function(data) {\n        data.CFTemplateURL = target;\n    });\n};\n},{}],5:[function(require,module,exports){\n/* jshint devel:true */\n/* global exports, require, cytoscape */\n\nexports.template = function(options) {\n  'use strict';\n\n  var editor = options.editor;\n  var collector = require('./collectdata');\n  var defaultContainer = options.graphContainer;\n  var jsonproxy = options.jsonproxy;\n  var graph;\n  var style;\n  var cyto = options.cytolib || cytoscape;\n  var initialData;\n  var layoutName = 'grid';\n\n  var layouts = {\n    'grid': {name: 'grid', fit: true, condense: true, cols: 4},\n    'breadthfirst': {name: 'breadthfirst', fit: true, directed: false, avoidOverlap: true, spacingFactor: 0.25},\n    'circle': {name: 'circle', fit: true, padding: 10, radius: 400, avoidOverlap: false, startAngle: Math.PI},\n    'concentric': {name: 'concentric', fit: true, padding: 10, avoidOverlap: false, startAngle: Math.PI}\n  };\n\n  var findLayout = function(name) {\n    return layouts[name] || {'name': name, 'fit': true, 'animate': false };\n  };\n\n  var setLayout = function(name) {\n    layoutName = name;\n    if (graph) {\n      graph.layout(findLayout(name));\n    }\n  };\n\n  if (!editor || !editor.getValue) {\n    throw 'editor unavailable or doesn\\'t support getValue';\n  }\n  if (!cyto) {\n    throw 'graphing library Cytoscape unavailable';\n  }\n\n  var json = function() {\n    return JSON.parse(editor.getValue());\n  };\n\n  var text = function(indent) {\n    return indent ? JSON.stringify(json(), null, indent) : editor.getValue();\n  };\n\n  var changeStyle = function(data) {\n    style = data;\n    if (graph) {\n      graph.style(style);\n    }\n  };\n\n  var show = function(data, container) {\n    if (!container && !defaultContainer) {\n      throw 'No container available to show data';\n    }\n    graph = cyto({\n      container: container || defaultContainer,\n      elements: data,\n      style: style,\n      layout: findLayout(layoutName)\n    });\n    graph.boxSelectionEnabled(true);\n    graph.on('style', 'node', function(event){\n      var cyTarget = event.cyTarget;\n      var cloudformationType = cyTarget.data('CFType');\n      if (cyTarget.css('background-image').match(/unknown\\.png/)) {\n        console.log('WARN using unknown.png, because no image available for ' + cloudformationType);\n      }\n    });\n  };\n\n  var setData = function(data, onSuccess, onError) {\n    if (data) {\n      try {\n        var dataString = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\n        var dataObject = typeof data === 'object' ? data : JSON.parse(data);\n\n        editor.setValue(dataString);\n        initialData = text();\n        show(collector.collectCyData(dataObject));\n\n        if (onSuccess) {\n          onSuccess();\n        }\n      }\n      catch (e) {\n        if (onError) {\n          onError('Error processing data as JSON', e);\n        }\n      }\n    }\n    else {\n      if (onError) {\n        onError('No data');\n      }\n    }\n  };\n\n  var fromFile = function(file, success, fail) {\n    var reader = new FileReader();\n    reader.onload = function() {\n      setData(reader.result, function() {\n        if (success) {\n          success(file.name);\n        }\n      }, function(reason, e) {\n        if (fail) {\n          fail(file.name, reason, e);\n        }\n      });\n\n    };\n    try {\n      reader.readAsText(file);\n    }\n    catch (e) {\n      if (fail) {\n        fail(file.name, e);\n      }\n    }\n  };\n\n  var refreshGraph = function() {\n    show(collector.collectCyData(json()));\n  };\n\n  var description = function() {\n    var description = 'template';\n    try {\n      description = json().Description;\n    }\n    catch (e) {}\n    return description;\n  };\n\n  var base64Image = function() {\n    if (!graph) {\n      return;\n    }\n    graph.center();\n    graph.fit();\n    return graph.png({\n      full: false\n    });\n  };\n\n\n  var fromURL = function(url, success, onError) {\n    if (!jsonproxy) {\n      throw 'No jsonproxy available to request URLs';\n    }\n    if (url) {\n      jsonproxy({\n        url: url,\n        corsSupport: true,\n        success: function(data) {\n          setData(data);\n          if (success) {\n            success(url);\n          }\n        },\n        error: function(data, textStatus) {\n            var message;\n            if (textStatus === 'parsererror') {\n              editor.setValue(data.responseText);\n              message = 'Unable to parse the result as valid JSON';\n            }\n            else {\n              message = 'Unable to load: status ' + data.status + ' ' + data.statusText;\n            }\n            if (onError) {\n              onError(url, message, data, textStatus);\n            }\n          }\n          // error, etc.\n      });\n    }\n  };\n\n  var fitGraph = function() {\n    if (graph) {\n      graph.fit();\n    }\n  };\n\n  var hasChanged = function() {\n    var changed = initialData === text();\n    return initialData ? ! changed : false;\n  };\n\n  return {\n    setData: setData,\n    fromFile: fromFile,\n    fromURL: fromURL,\n    refreshGraph: refreshGraph,\n    setLayout: setLayout,\n    base64Image: base64Image,\n    description: description,\n    changeStyle: changeStyle,\n    fitGraph: fitGraph,\n    getGraph: function() { return graph; },\n    text: text,\n    json: json,\n    hasChanged: hasChanged,\n    initialData: initialData\n  };\n};\n\n},{\"./collectdata\":1}]},{},[2])\n\n","/* jshint devel:true */\n/* global saveAs, require, CodeMirror, alertify, cytoscape */\n\n(function() {\n  'use strict';\n\n  var graphArea = $('#graph_area');\n  var refreshTimeoutID;\n\n  var queryTools = require('./queryparser');\n\n  var remoteInput = $('#remote_input');\n\n  var showGraphBackGround = function (hidden) {\n    graphArea.css('background-image', !hidden ? 'url(\"images/aws-cloudformation-template.svg\")' : '');\n  };\n\n  var myCodeMirror = new CodeMirror(document.getElementById('editor'), {\n    value: '{}',\n    lineNumbers: true,\n    mode: 'application/json',\n    foldGutter: true,\n    gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter', 'CodeMirror-lint-markers'],\n\n  });\n  myCodeMirror.setSize('100%', '800px');\n\n  var template = require('./template').template({\n    'editor': {\n      setValue: function(value) { myCodeMirror.getDoc().setValue(value); },\n      getValue: function() { return myCodeMirror.getDoc().getValue(); }\n    },\n    'cytolib': cytoscape,\n    'graphContainer': graphArea[0],\n    'jsonproxy': $.jsonp\n  });\n\n  window.getTemplate = function() { return template; };\n\n  var myConfirmation = function(event) {\n    if (!template.hasChanged()) {\n      return undefined;\n    }\n    if (event && event.type === 'beforeunload') {\n      event.returnValue = 'The current template has unsaved changes.';\n      return 'The current template has unsaved changes.';\n    }\n    return window.confirm('The current template has unsaved changes. Continue loading?');\n  };\n\n  var loadTemplate = function(loadFn, url) {\n    if (!url || (template.hasChanged() && !myConfirmation())) {\n      return;\n    }\n    loadFn(\n      url,\n      function(templateLocation) {\n        showGraphBackGround(true);\n        if (typeof url === 'string') {\n          if (remoteInput.val() !== url) {\n            remoteInput.val(url);\n          }\n          var embedUrl = queryTools.createEmbedUrl(window.location, url);\n          $('#embed_link').html('Use <a href=\"' + embedUrl + '\">' + embedUrl + '</a> to open directly');\n        }\n        else {\n          remoteInput.val('');\n          $('#embed_link').html('');\n        }\n        alertify.success('Loaded template \"' + templateLocation + '\" successfully');\n      },\n      function(templateLocation, reason, e) {\n        template.setData('{\"Error\": \"Unable to load template ' + templateLocation + ' because of ' + reason + '\" }', showGraphBackGround);\n        alertify.error('Unable to load template \"' + templateLocation + '\" because of ' + reason);\n        console.log(e);\n      }\n    );\n  };\n\n  $.ajax({\n    url: 'styles/main.cycss',\n    type: 'GET',\n    dataType: 'text',\n    success: function(responseText) {\n      template.changeStyle(responseText);\n    }\n  });\n\n  var delayedRefresh = function() {\n    template.refreshGraph();\n    $('#embed_link').toggle(!template.hasChanged());\n    refreshTimeoutID = undefined;\n  };\n\n  myCodeMirror.setOption('lint', {\n    onUpdateLinting: function(annotations) {\n      if (template && (!annotations || annotations.length === 0)) {\n        if (refreshTimeoutID) {\n          window.clearTimeout(refreshTimeoutID);\n        }\n        refreshTimeoutID = window.setTimeout(delayedRefresh, 300);\n      }\n    }\n  });\n\n  graphArea[0].addEventListener('dragover', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    evt.dataTransfer.dropEffect = 'copy';\n  }, false);\n  graphArea[0].addEventListener('drop', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    loadTemplate(template.fromFile, evt.dataTransfer.files[0]);\n  }, false);\n\n\n  var isResizing = false,\n    lastDownX = 0;\n\n\n  var getTemplateUrl = function () {\n    var url = remoteInput.val();\n    if (remoteInput[0].checkValidity()){\n      remoteInput.hide();\n      return url;\n    }\n    return undefined;\n  };\n\n\n  $('#remote_input').keypress(function(e) {\n    if (e.which === 13) {\n      loadTemplate(template.fromURL, getTemplateUrl());\n      return false;\n    }\n  });\n\n  $('#open_template').click(function(event) {\n    event.preventDefault();\n    $('#template_input').click();\n  });\n  $('#template_input').change(function(event) {\n    loadTemplate(template.fromFile, event.target.files[0]);\n  });\n\n  $('#open_url').click(function(event) {\n    event.preventDefault();\n    if (remoteInput.is(':visible')) {\n      loadTemplate(template.fromURL, getTemplateUrl());\n    }\n    else {\n      remoteInput.show();\n    }\n  });\n\n  $('#save_template').click(function(event) {\n    event.preventDefault();\n    saveAs(\n      new Blob( [template.text(2)], { type: 'text/plain;charset=utf-8' }),\n      template.description() + '.json'\n    );\n    return false;\n  });\n  $('#save_graph').click(function(event) {\n    event.preventDefault();\n    var saveWindow = window.open('savegraph.html');\n    saveWindow.onload = function() {\n      saveWindow.document.getElementById('graphPNG').src = template.base64Image();\n    };\n    return false;\n  });\n  $('#graph_layout').change(function() {\n    template.setLayout($('#graph_layout').val());\n  });\n\n  var container = $('#container'),\n    editorPane = $('#editor_pane');\n\n  $('#border').on('mousedown', function(e) {\n    isResizing = true;\n    lastDownX = e.clientX;\n  });\n\n  $(document).on('mousemove', function(e) {\n    // we don't want to do anything if we aren't resizing.\n    if (!isResizing) {\n      return;\n    }\n\n    var offsetRight = container.width() - (e.clientX - container.offset().left);\n\n    graphArea.css('right', offsetRight);\n    editorPane.css('width', offsetRight);\n  }).on('mouseup', function() {\n    if (isResizing) {\n      template.fitGraph();\n    }\n    // stop resizing\n    isResizing = false;\n  });\n\n  $(document).ready(function() {\n    showGraphBackGround();\n    //----- Parse Query -----//\n    queryTools.parser(window.location.search, {\n      onTemplate: function(url) {\n        loadTemplate(template.fromURL, url);\n      }\n    });\n    //----- Parse Query -----//\n\n    window.addEventListener('beforeunload', myConfirmation);\n  });\n})();\n","/* jshint devel:true */\n/* global exports */\n\n// findEdges/findIn\n//  - startElement element to traverse through\n//  - title        resource title to push to callback function\n// returns an array of edge objects with properties label, toResource and toProperty\n//\nexports.findEdges = function findIn (start, title) {\n  'use strict';\n  var found = [];\n  // If start is an array then let's loop through all elements to find edges\n  //\n  if (start instanceof Array) {\n    start.forEach(function(elem){\n      found.push( findIn(elem, title || '') );\n    });\n  }\n  // Else if we hit some object and we should delve into it\n  //\n  else if (typeof start === 'object') {\n    // When we only have one key then it's probably some CloudFormation function\n    // we can use to make an make edge with\n    //\n    if (Object.keys(start).length === 1) {\n      var fn = Object.keys(start)[0];\n      // If we hit a Ref, it's definitely a reference of some sorts\n      // usually we only hit this option deep and the title should be available\n      // otherwise give an empty title\n      //\n      if (fn === 'Ref' && typeof start[fn] === 'string') {\n        found.push({label: title || '', toResource: start[fn], toProperty: title || ''});\n      }\n      // An Fn::Join is trickier, we might find edges recursively\n      //\n      else if (fn === 'Fn::Join' && start[fn] instanceof Array) {\n        start[fn][1].forEach(function(elem) {\n          found.push( findIn(elem, start[fn][1].join(start[fn][0])) );\n        });\n      }\n      // If we see an Fn::GetAtt then make an edge with the reference,\n      // not the attribute\n      //\n      else if (fn === 'Fn::GetAtt' && start[fn] instanceof Array) {\n        found.push({label: title, toResource: start[fn][0], toProperty: start[fn][1]});\n      }\n      // Ok, forgot why this path is necessary, I guess it's when we didn't find\n      //  something to easily pull references from and we probably need to keep\n      //  searching anyway\n      //\n      else {\n        for (var key in start) {\n          found.push( findIn(start[key],  key) );\n        }\n      }\n    }\n    // if we have more than one key we have to delve deeper to find edges\n    //\n    else {\n      for (var k in start) {\n        found.push( findIn(start[k], k) );\n      }\n    }\n  }\n  return [].concat.apply([], found); // return a flattened array http://stackoverflow.com/a/10865042/60201\n};\n","/* jshint devel:true */\n/* global exports, URI */\n\nexports.parser = function(url, callbacks) {\n    'use strict';\n    if (url) {\n        var queryMap = new URI(url).search(true);\n        if (queryMap.CFTemplateURL && callbacks.onTemplate) {\n            callbacks.onTemplate(queryMap.CFTemplateURL);\n        }\n    }\n};\n\nexports.createEmbedUrl = function(host, target) {\n    'use strict';\n    return new URI(host).search(function(data) {\n        data.CFTemplateURL = target;\n    });\n};","/* jshint devel:true */\n/* global exports, require, cytoscape */\n\nexports.template = function(options) {\n  'use strict';\n\n  var editor = options.editor;\n  var collector = require('./collectdata');\n  var defaultContainer = options.graphContainer;\n  var jsonproxy = options.jsonproxy;\n  var graph;\n  var style;\n  var cyto = options.cytolib || cytoscape;\n  var initialData;\n  var layoutName = 'grid';\n\n  var layouts = {\n    'grid': {name: 'grid', fit: true, condense: true, cols: 4},\n    'breadthfirst': {name: 'breadthfirst', fit: true, directed: false, avoidOverlap: true, spacingFactor: 0.25},\n    'circle': {name: 'circle', fit: true, padding: 10, radius: 400, avoidOverlap: false, startAngle: Math.PI},\n    'concentric': {name: 'concentric', fit: true, padding: 10, avoidOverlap: false, startAngle: Math.PI}\n  };\n\n  var findLayout = function(name) {\n    return layouts[name] || {'name': name, 'fit': true, 'animate': false };\n  };\n\n  var setLayout = function(name) {\n    layoutName = name;\n    if (graph) {\n      graph.layout(findLayout(name));\n    }\n  };\n\n  if (!editor || !editor.getValue) {\n    throw 'editor unavailable or doesn\\'t support getValue';\n  }\n  if (!cyto) {\n    throw 'graphing library Cytoscape unavailable';\n  }\n\n  var json = function() {\n    return JSON.parse(editor.getValue());\n  };\n\n  var text = function(indent) {\n    return indent ? JSON.stringify(json(), null, indent) : editor.getValue();\n  };\n\n  var changeStyle = function(data) {\n    style = data;\n    if (graph) {\n      graph.style(style);\n    }\n  };\n\n  var show = function(data, container) {\n    if (!container && !defaultContainer) {\n      throw 'No container available to show data';\n    }\n    graph = cyto({\n      container: container || defaultContainer,\n      elements: data,\n      style: style,\n      layout: findLayout(layoutName)\n    });\n    graph.boxSelectionEnabled(true);\n    graph.on('style', 'node', function(event){\n      var cyTarget = event.cyTarget;\n      var cloudformationType = cyTarget.data('CFType');\n      if (cyTarget.css('background-image').match(/unknown\\.png/)) {\n        console.log('WARN using unknown.png, because no image available for ' + cloudformationType);\n      }\n    });\n  };\n\n  var setData = function(data, onSuccess, onError) {\n    if (data) {\n      try {\n        var dataString = typeof data === 'string' ? data : JSON.stringify(data, null, 2);\n        var dataObject = typeof data === 'object' ? data : JSON.parse(data);\n\n        editor.setValue(dataString);\n        initialData = text();\n        show(collector.collectCyData(dataObject));\n\n        if (onSuccess) {\n          onSuccess();\n        }\n      }\n      catch (e) {\n        if (onError) {\n          onError('Error processing data as JSON', e);\n        }\n      }\n    }\n    else {\n      if (onError) {\n        onError('No data');\n      }\n    }\n  };\n\n  var fromFile = function(file, success, fail) {\n    var reader = new FileReader();\n    reader.onload = function() {\n      setData(reader.result, function() {\n        if (success) {\n          success(file.name);\n        }\n      }, function(reason, e) {\n        if (fail) {\n          fail(file.name, reason, e);\n        }\n      });\n\n    };\n    try {\n      reader.readAsText(file);\n    }\n    catch (e) {\n      if (fail) {\n        fail(file.name, e);\n      }\n    }\n  };\n\n  var refreshGraph = function() {\n    show(collector.collectCyData(json()));\n  };\n\n  var description = function() {\n    var description = 'template';\n    try {\n      description = json().Description;\n    }\n    catch (e) {}\n    return description;\n  };\n\n  var base64Image = function() {\n    if (!graph) {\n      return;\n    }\n    graph.center();\n    graph.fit();\n    return graph.png({\n      full: false\n    });\n  };\n\n\n  var fromURL = function(url, success, onError) {\n    if (!jsonproxy) {\n      throw 'No jsonproxy available to request URLs';\n    }\n    if (url) {\n      jsonproxy({\n        url: url,\n        corsSupport: true,\n        success: function(data) {\n          setData(data);\n          if (success) {\n            success(url);\n          }\n        },\n        error: function(data, textStatus) {\n            var message;\n            if (textStatus === 'parsererror') {\n              editor.setValue(data.responseText);\n              message = 'Unable to parse the result as valid JSON';\n            }\n            else {\n              message = 'Unable to load: status ' + data.status + ' ' + data.statusText;\n            }\n            if (onError) {\n              onError(url, message, data, textStatus);\n            }\n          }\n          // error, etc.\n      });\n    }\n  };\n\n  var fitGraph = function() {\n    if (graph) {\n      graph.fit();\n    }\n  };\n\n  var hasChanged = function() {\n    var changed = initialData === text();\n    return initialData ? ! changed : false;\n  };\n\n  return {\n    setData: setData,\n    fromFile: fromFile,\n    fromURL: fromURL,\n    refreshGraph: refreshGraph,\n    setLayout: setLayout,\n    base64Image: base64Image,\n    description: description,\n    changeStyle: changeStyle,\n    fitGraph: fitGraph,\n    getGraph: function() { return graph; },\n    text: text,\n    json: json,\n    hasChanged: hasChanged,\n    initialData: initialData\n  };\n};\n"],"sourceRoot":"/source/"}