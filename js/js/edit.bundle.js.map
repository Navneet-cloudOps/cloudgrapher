{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","app/scripts/collectdata.js","edit.bundle.js","app/scripts/edit.js","app/scripts/findedges.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","findEdges","graphOptions","nodes","brokenImage","edges","style","color.highlight","stabilize","zoomExtentOnStabilize","collectData","json","data","knownResources","possibleEdges","addEdge","toId","title","push","from","resourceKey","to","Resources","resource","props","Properties","group","Type","toLowerCase","replace","id","label","shape","image","filter","edge","indexOf","./findedges",2,"editor","graph","graphPane","collector","ace","edit","setTheme","getSession","setMode","setOption","on","annotations","getAnnotations","$","toggleClass","message","getLength","getLine","text","firstAnnotation","row","column","StatusBar","document","getElementById","commands","addCommand","name","bindKey","win","mac","exec","config","loadModule","init","showKeyboardShortcuts","loadTemplate","file","reader","FileReader","onload","result","setValue","navigateTo","resize","readAsText","showVisGraph","JSON","parse","getValue","setData","vis","Network","get","redraw","zoomExtent","fadeIn","easingFunction","getTemplateDescription","description","Description","saveImage","canvas","find","toBlob","blob","saveAs","console","error","saveTemplate","prettyDoc","stringify","Blob","type","mainRow","addEventListener","evt","stopPropagation","preventDefault","dataTransfer","dropEffect","files","change","event","target","click","fadeOut","./collectdata",3,"findIn","start","makeEdge","Array","forEach","elem","Object","keys","fn","join","key","k"],"mappings":"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","file":"edit.bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* jshint devel:true */\n/* global exports, require */\nvar findEdges = require('./findedges').findEdges;\nexports.graphOptions = {\n  'nodes': {\n    'brokenImage': 'images/unknown.png'\n  },\n  'edges': {\n    'style' : 'arrow',\n    'color.highlight': 'red'\n  },\n  'stabilize': true,\n  'zoomExtentOnStabilize': true\n};\nexports.collectData = function(json) {\n  'use strict';\n  var data = { nodes:[], edges:[] };\n  var knownResources = [];\n  var possibleEdges = [];\n  var addEdge = function (toId, title){\n    possibleEdges.push( {'from': resourceKey, 'to': toId, 'title': title } );\n  };\n  for (var resourceKey in json.Resources) {\n    var resource = json.Resources[resourceKey];\n    var props = resource.Properties;\n    var group = resource.Type.toLowerCase().replace(/::/g,'-');\n    knownResources.push(resourceKey);\n    data.nodes.push({\n      'id'   : resourceKey,\n      'label': resourceKey,\n      'group': group,\n      'shape': 'image',\n      'image': 'images/' + group + '.png'\n    });\n    findEdges(props, addEdge);\n  }\n  data.edges = possibleEdges.filter(function(edge) {\n    return edge && knownResources.indexOf(edge.to) >= 0;\n  });\n  return data;\n};\n",null,"/* jshint devel:true */\n/* global ace, vis, saveAs, require */\n\n(function(){'use strict';\n  var editor;\n  var collector = require('./collectdata');\n  var graph;\n  var graphPane;\n  editor = ace.edit('jsoneditor');\n  editor.setTheme('ace/theme/tomorrow_night_eighties');\n  editor.getSession().setMode('ace/mode/json');\n  editor.setOption('maxLines', 60);\n  editor.setOption('minLines', 40);\n  editor.getSession().on('changeAnnotation', function() {\n    var annotations = editor.getSession().getAnnotations();\n    $('#statusbar').toggleClass('failure', annotations.length !== 0);\n    if (annotations.length === 0) {\n      var message = editor.getSession().getLength() < 2 && editor.getSession().getLine(0).length === 0 ? 'No content' : 'Valid';\n      $('div.status-message').text(message);\n    }\n    else {\n      var firstAnnotation = annotations[0];\n      $('div.status-message').text(firstAnnotation.text + ' at '+ firstAnnotation.row + ':'+ firstAnnotation.column);\n    }\n  });\n  var StatusBar = ace.require('ace/ext/statusbar').StatusBar;\n  // create a simple selection status indicator\n  new StatusBar(editor, document.getElementById('statusbar'));\n  editor.commands.addCommand({\n    name: 'showKeyboardShortcuts',\n    bindKey: {win: 'Ctrl-Alt-h', mac: 'Command-Alt-h'},\n    exec: function(editor) {\n      ace.config.loadModule('ace/ext/keybinding_menu', function(module) {\n        module.init(editor);\n        editor.showKeyboardShortcuts();\n      });\n    }\n  });\n\n  var loadTemplate = function(file){\n    var reader = new FileReader();\n    reader.onload = function () {\n      var data = reader.result;\n      if(data) {\n        editor.setValue(data);\n        editor.navigateTo(0, 0);\n      }\n      editor.resize();\n    };\n    reader.readAsText(file);\n  };\n  var showVisGraph = function() {\n    var data;\n    try {\n      data = collector.collectData(JSON.parse(editor.getValue()));\n    }\n    catch (e) {\n      data = {};\n    }\n    if (!graphPane) {\n      graphPane = $('div.graph_overlay');\n      graph = new vis.Network($('#graph_area').get(0), data, collector.graphOptions);\n      graphPane.resize(function() {\n        graph.redraw();\n        graph.zoomExtent();\n      });\n    }\n    else {\n      graph.setData(data);\n    }\n    graphPane.fadeIn(300, function(){\n      graph.redraw();\n      graph.zoomExtent({easingFunction: 'linear'});\n    });\n  };\n  var getTemplateDescription = function() {\n    var description = 'template';\n    try {\n      description = JSON.parse(editor.getValue(editor.getValue())).Description;\n    } catch (e) {}\n    return description;\n  };\n  var saveImage = function() {\n    var canvas = graphPane.find('canvas');\n    if (canvas && canvas.length === 1) {\n      canvas[0].toBlob(function(blob){\n        saveAs(blob, getTemplateDescription() + '.png');\n      });\n    }\n    else {\n      console.error('Expected to find one canvas but got ' + canvas);\n    }\n  };\n  var saveTemplate = function() {\n    var prettyDoc = JSON.stringify(JSON.parse(editor.getValue()), null, 2);\n    var blob = new Blob([prettyDoc], {type: 'text/plain;charset=utf-8'});\n    saveAs(blob, getTemplateDescription() + '.json');\n  };\n  var mainRow = document.getElementById('cfeditor');\n  mainRow.addEventListener('dragover', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n    evt.dataTransfer.dropEffect = 'copy';\n  }, false);\n  mainRow.addEventListener('drop', function(evt) {\n    evt.stopPropagation();\n    evt.preventDefault();\n\n    loadTemplate(evt.dataTransfer.files[0]);\n  }, false);\n  $('#open_template').change(function(event){ loadTemplate(event.target.files[0]); });\n  $('#save_template').click(function(event){ event.preventDefault(); saveTemplate(); return false;});\n  $('#save_graph').click(function(event){ event.preventDefault(); saveImage(); return false;});\n  $('#show_graph').click(function(event){ event.preventDefault(); showVisGraph(); return false;});\n  $('#close_graph').click(function(event){ event.preventDefault(); graphPane.fadeOut(500); return false;});\n})();\n","/* jshint devel:true */\n/* global exports */\nexports.findEdges = function findIn (start, makeEdge, title) {\n  'use strict';\n  if (start instanceof Array) {\n    start.forEach(function(elem){\n      findIn(elem, makeEdge, title || '');\n    });\n  }\n  else if (typeof start === 'object') {\n    if (Object.keys(start).length === 1) {\n      var fn = Object.keys(start)[0];\n      if (fn === 'Ref' && typeof start[fn] === 'string') {\n        makeEdge(start[fn], title || '');\n      }\n      else if (fn === 'Fn::Join' && start[fn] instanceof Array) {\n        start[fn][1].forEach(function(elem) {\n          findIn(elem, makeEdge, start[fn][1].join(start[fn][0]));\n        });\n      }\n      else if (fn === 'Fn::GetAtt' && start[fn] instanceof Array) {\n        makeEdge(start[fn][0], start[fn][1]);\n      }\n      else {\n        for (var key in start) {\n          findIn(start[key], makeEdge, key);\n        }\n      }\n    }\n    else {\n      for (var k in start) {\n        findIn(start[k], makeEdge, k);\n      }\n    }\n  }\n};\n"],"sourceRoot":"/source/"}