!function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[i]={exports:{}};t[i][0].call(f.exports,function(e){var r=t[i][1][e];return o(r?r:e)},f,f.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){var n=e("./findedges").findEdges;r.graphOptions={nodes:{brokenImage:"images/unknown.png"},edges:{style:"arrow","color.highlight":"red"},stabilize:!0,zoomExtentOnStabilize:!0},r.collectData=function(e){"use strict";var t={nodes:[],edges:[]},r=[],o=[],a=function(e,t){o.push({from:i,to:e,title:t})};for(var i in e.Resources){var s=e.Resources[i],u=s.Properties,c=s.Type.toLowerCase().replace(/::/g,"-");r.push(i),t.nodes.push({id:i,label:i,group:c,shape:"image",image:"images/"+c+".png"}),n(u,a)}return t.edges=o.filter(function(e){return e&&r.indexOf(e.to)>=0}),t},r.collectCyData=function(e){"use strict";var t={"AWS::EC2::SecurityGroupIngress":function(e){if("GroupId"===e.data.resource);else if("SourceSecurityGroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"AWS::EC2::SecurityGroupEgress":function(e){if("DestinationSecurityGroupId"===e.data.resource);else if("GroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"default":function(e,t,r){return r&&"AWS::EC2::SecurityGroup"===r.type&&"AWS::EC2::SecurityGroup"!==t.type?(i[e.data.source].data.parent=e.data.target,!1):!0},get:function(e){return this[e]||this["default"]}},r={nodes:[],edges:[]},o=0,a=function(e,t,r){s.push({data:{id:"e"+o++,source:u,target:e,title:t,resource:r}})},i={},s=[];for(var u in e.Resources){var c=e.Resources[u],f={data:{id:u},classes:c.Type.toLowerCase().replace(/::/g,"-"),type:c.Type};n(c.Properties,a),i[u]=f,r.nodes.push(f)}return r.edges=s.filter(function(e){var r=i[e.data.source],n=i[e.data.target],o=t.get(r.type);return e&&r&&n&&o(e,r,n)}),r}},{"./findedges":3}],2:[function(e,t,r){!function(){"use strict";var t=new CodeMirror(document.getElementById("editor"),{value:"{}",lineNumbers:!0,mode:"application/json",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:{onUpdateLinting:function(e){!n||e&&0!==e.length||n.refreshGraph()}}});t.setSize("100%","800px");var r=$("#graph_area"),n=e("./template").template({editor:t,cytolib:cytoscape,graphContainer:r[0],jsonproxy:$.jsonp});$.ajax({url:"styles/main.cycss",type:"GET",dataType:"text",success:function(e){n.changeStyle(e)}});var o=!1,a=0,i=$("#remote_input"),s=function(){n.fromURLInput(i,function(e){r.css("background-image",""),alertify.success('Loaded URL "'+e+'" successfully')},function(e,t){alertify.error('Error while loading URL "'+e+'" :'+t)})},u=function(e){n.load(e,function(e){r.css("background-image",""),alertify.success('Loaded file "'+e+'"')},function(e,t){alertify.error('Unable to load file "'+e+'" because of '+t)})},c=function(){var e=window.open("savegraph.html");e.onload=function(){e.document.getElementById("graphPNG").src=n.base64Image()}},f=function(){var e=new Blob([n.text(2)],{type:"text/plain;charset=utf-8"});saveAs(e,n.description()+".json")},l=document.getElementById("graph_area");l.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),l.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),u(e.dataTransfer.files[0])},!1),$("#graph_area").css("background-image",'url("images/aws-cloudformation-template.svg")'),$("#open_template").click(function(e){e.preventDefault(),$("#template_input").click()}),$("#open_url").click(function(e){e.preventDefault(),i.is(":visible")?s():i.show()}),$("#template_input").change(function(e){u(e.target.files[0])}),$("#save_template").click(function(e){return e.preventDefault(),f(),!1}),$("#save_graph").click(function(e){return e.preventDefault(),c(),!1}),$("#graph_layout").change(function(){n.setLayout($("#graph_layout").val())}),$("#remote_input").keypress(function(e){return 13===e.which?(s(),!1):void 0});var p=$("#container"),d=$("#graph_area"),g=$("#editor_pane"),y=$("#border");y.on("mousedown",function(e){o=!0,a=e.clientX}),$(document).on("mousemove",function(e){if(o){var t=p.width()-(e.clientX-p.offset().left);d.css("right",t),g.css("width",t)}}).on("mouseup",function(){o&&n.fitGraph(),o=!1})}()},{"./template":4}],3:[function(e,t,r){r.findEdges=function n(e,t,r){"use strict";if(e instanceof Array)e.forEach(function(e){n(e,t,r||"")});else if("object"==typeof e)if(1===Object.keys(e).length){var o=Object.keys(e)[0];if("Ref"===o&&"string"==typeof e[o])t(e[o],r||"",r);else if("Fn::Join"===o&&e[o]instanceof Array)e[o][1].forEach(function(r){n(r,t,e[o][1].join(e[o][0]))});else if("Fn::GetAtt"===o&&e[o]instanceof Array)t(e[o][0],e[o][1],r);else for(var a in e)n(e[a],t,a)}else for(var i in e)n(e[i],t,i)}},{}],4:[function(e,t,r){r.template=function(t){"use strict";var r,n,o=t.editor,a=e("./collectdata"),i=t.graphContainer,s=t.jsonproxy,u=t.cytolib||cytoscape;if(!o||!o.getDoc)throw"editor unavailable or doesn't support getDoc";if(!u)throw"graphing library Cytoscape unavailable";var c=function(e){n=e,r&&r.style(n)},f=function(e,t,r){var n=new FileReader;n.onload=function(){l(n.result,function(){t&&t(e.name)},function(t){r&&r(e.name,t)})},n.readAsText(e)},l=function(e,t,r){if(e)try{var n="string"==typeof e?e:JSON.stringify(e,null,2),i="object"==typeof e?e:JSON.parse(e);o.getDoc().setValue(n),d(a.collectCyData(i)),t&&t()}catch(s){r&&r("Error processing data as JSON",s)}else r&&r("No data")},p=function(){d(a.collectCyData(h()))},d=function(e,t){if(!t&&!i)throw"No container available to show data";r=u({container:t||i,elements:e,style:n,layout:{name:"cose",padding:5}}),r.boxSelectionEnabled(!0)},g=function(){var e="template";try{e=h().Description}catch(t){}return e},y=function(){return r?(r.center(),r.fit(),r.png({full:!1})):void 0},h=function(){return JSON.parse(o.getDoc().getValue())},v=function(e){r&&r.layout({name:e})},m=function(e,t,r){if(!s)throw"No jsonproxy available to request URLs";e&&s({url:e,corsSupport:!0,success:function(r){l(r),t&&t(e)},error:function(t,n){var a;"parsererror"===n?(o.getDoc().setValue(t.responseText),a="Unable to parse the result as valid JSON"):a="Unable to load: status "+t.status+" "+t.statusText,r&&r(e,a,t,n)}})},b=function(e,t,r){var n=e.val();return e[0].checkValidity()?(e.hide(),void m(n,t,r)):!1},w=function(e){return e?JSON.stringify(h(),null,e):o.getDoc().getValue()},S=function(){r&&r.fit()};return{load:f,setData:l,fromURLInput:b,fromURL:m,refreshGraph:p,setLayout:v,base64Image:y,description:g,changeStyle:c,fitGraph:S,text:w,json:h}}},{"./collectdata":1}]},{},[2]);
//# sourceMappingURL=edit.bundle.js.map
