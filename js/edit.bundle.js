!function e(t,r,n){function a(i,u){if(!r[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var f=r[i]={exports:{}};t[i][0].call(f.exports,function(e){var r=t[i][1][e];return a(r?r:e)},f,f.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,t,r){var n=e("./findedges").findEdges;r.graphOptions={nodes:{brokenImage:"images/unknown.png"},edges:{style:"arrow","color.highlight":"red"},stabilize:!0,zoomExtentOnStabilize:!0},r.collectData=function(e){"use strict";var t={nodes:[],edges:[]},r=[],a=[],o=function(e,t){a.push({from:i,to:e,title:t})};for(var i in e.Resources){var u=e.Resources[i],s=u.Properties,c=u.Type.toLowerCase().replace(/::/g,"-");r.push(i),t.nodes.push({id:i,label:i,group:c,shape:"image",image:"images/"+c+".png"}),n(s,o)}return t.edges=a.filter(function(e){return e&&r.indexOf(e.to)>=0}),t},r.collectCyData=function(e){"use strict";var t={"AWS::EC2::SecurityGroupIngress":function(e){if("GroupId"===e.data.resource);else if("SourceSecurityGroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"AWS::EC2::SecurityGroupEgress":function(e){if("DestinationSecurityGroupId"===e.data.resource);else if("GroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"default":function(e,t,r){return r&&"AWS::EC2::SecurityGroup"===r.type&&"AWS::EC2::SecurityGroup"!==t.type?(i[e.data.source].data.parent=e.data.target,!1):!0},get:function(e){return this[e]||this["default"]}},r={nodes:[],edges:[]},a=0,o=function(e,t,r){u.push({data:{id:"e"+a++,source:s,target:e,title:t,resource:r}})},i={},u=[];for(var s in e.Resources){var c=e.Resources[s],f={data:{id:s},classes:c.Type.toLowerCase().replace(/::/g,"-"),type:c.Type};n(c.Properties,o),i[s]=f,r.nodes.push(f)}return r.edges=u.filter(function(e){var r=i[e.data.source],n=i[e.data.target],a=t.get(r.type);return e&&r&&n&&a(e,r,n)}),r}},{"./findedges":3}],2:[function(e,t,r){!function(){"use strict";var t=e("./collectdata"),r=new CodeMirror(document.getElementById("editor"),{value:"",lineNumbers:!0,mode:"application/json",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:{onUpdateLinting:function(e){e&&0!==e.length||s(t.collectCyData(JSON.parse(r.getDoc().getValue())))}}});r.setSize("100%","800px");var n,a=$.ajax({url:"styles/main.cycss",type:"GET",dataType:"text"}),o=!1,i=0,u=function(e){var n=new FileReader;n.onload=function(){var e=n.result;if(console.log(e),e)try{r.getDoc().setValue(e),s(t.collectCyData(JSON.parse(e))),$("#graph_area").css("background-image","")}catch(a){console.log("ERR - "+a)}},n.readAsText(e)},s=function(e){n=cytoscape({container:document.getElementById("graph_area"),elements:e,style:a,layout:{name:"cose",padding:5}}),n.boxSelectionEnabled(!0)},c=function(){var e="template";try{e=JSON.parse(editor.getValue(editor.getValue())).Description}catch(t){}return e},f=function(){var e=window.open("savegraph.html");n.center(),n.fit(),e.onload=function(){e.document.getElementById("graphPNG").src=n.png({full:!1})}},l=function(){var e=JSON.stringify(JSON.parse(editor.getValue()),null,2),t=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(t,c()+".json")},d=document.getElementById("graph_area");d.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),d.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),u(e.dataTransfer.files[0])},!1),$("#graph_area").css("background-image",'url("/images/aws-cloudformation-template.svg")'),$("#open_template").change(function(e){u(e.target.files[0])}),$("#save_template").click(function(e){return e.preventDefault(),l(),!1}),$("#save_graph").click(function(e){return e.preventDefault(),f(),!1}),$("#graph_layout").change(function(){n.layout({name:$("#graph_layout").val()})});var p=$("#container"),g=$("#graph_area"),y=$("#editor_pane"),v=$("#border");v.on("mousedown",function(e){o=!0,i=e.clientX}),$(document).on("mousemove",function(e){if(o){var t=p.width()-(e.clientX-p.offset().left);g.css("right",t),y.css("width",t)}}).on("mouseup",function(){o&&n&&n.fit(),o=!1})}()},{"./collectdata":1}],3:[function(e,t,r){r.findEdges=function n(e,t,r){"use strict";if(e instanceof Array)e.forEach(function(e){n(e,t,r||"")});else if("object"==typeof e)if(1===Object.keys(e).length){var a=Object.keys(e)[0];if("Ref"===a&&"string"==typeof e[a])t(e[a],r||"",r);else if("Fn::Join"===a&&e[a]instanceof Array)e[a][1].forEach(function(r){n(r,t,e[a][1].join(e[a][0]))});else if("Fn::GetAtt"===a&&e[a]instanceof Array)t(e[a][0],e[a][1],r);else for(var o in e)n(e[o],t,o)}else for(var i in e)n(e[i],t,i)}},{}]},{},[2]);
//# sourceMappingURL=edit.bundle.js.map