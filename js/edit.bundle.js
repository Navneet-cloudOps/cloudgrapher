!function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return a(n?n:e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,n){var r=e("./findedges").findEdges;n.graphOptions={nodes:{brokenImage:"images/unknown.png"},edges:{style:"arrow","color.highlight":"red"},stabilize:!0,zoomExtentOnStabilize:!0},n.collectData=function(e){"use strict";var t={nodes:[],edges:[]},n=[],a=[],o=function(e){a.push({from:this,to:e.toResource,title:e.label})};for(var i in e.Resources){var s=e.Resources[i],u=s.Properties,c=s.Type.toLowerCase().replace(/::/g,"-");n.push(i),t.nodes.push({id:i,label:i,group:c,shape:"image",image:"images/"+c+".png"}),r(u).forEach(o,i)}return t.edges=a.filter(function(e){return e&&n.indexOf(e.to)>=0}),t},n.collectCyData=function(e){"use strict";var t={},n=[],a={"AWS::EC2::SecurityGroupIngress":function(e){if("GroupId"===e.data.title);else if("SourceSecurityGroupId"===e.data.title){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"AWS::EC2::SecurityGroupEgress":function(e){if("DestinationSecurityGroupId"===e.data.title);else if("GroupId"===e.data.title){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"default":function(e,n,r){return r&&"AWS::EC2::SecurityGroup"===r.type&&"AWS::EC2::SecurityGroup"!==n.type?(t[e.data.source].data.parent=e.data.target,!1):!0},get:function(e){return this[e]||this["default"]}},o={nodes:[],edges:[]},i=0,s=function(e){n.push({data:{id:"e"+i++,source:this,target:e.toResource,title:e.label,targetProperty:e.toProperty}})};for(var u in e.Resources){var c=e.Resources[u],l=c.Type.toLowerCase().replace(/::/g,"-"),f={data:{id:u,CFType:c.Type,nodeClass:l},classes:l,type:c.Type};r(c.Properties).forEach(s,u),t[u]=f,o.nodes.push(f)}return o.edges=n.filter(function(e){var n=t[e.data.source],r=t[e.data.target],o=a.get(n.type);return e&&n&&r&&o(e,n,r)}),o}},{"./findedges":3}],2:[function(e,t,n){!function(){"use strict";var t,n=$("#graph_area"),r=e("./queryparser"),a=$("#remote_input"),o=function(e){n.css("background-image",e?"":'url("images/aws-cloudformation-template.svg")')},i=new CodeMirror(document.getElementById("editor"),{value:"{}",lineNumbers:!0,mode:"application/json",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"]});i.setSize("100%","800px");var s=e("./template").template({editor:{setValue:function(e){i.getDoc().setValue(e)},getValue:function(){return i.getDoc().getValue()}},cytolib:cytoscape,graphContainer:n[0],jsonproxy:$.jsonp});window.getTemplate=function(){return s};var u=function(e){return s.hasChanged()?e&&"beforeunload"===e.type?(e.returnValue="The current template has unsaved changes.","The current template has unsaved changes."):window.confirm("The current template has unsaved changes. Continue loading?"):void 0},c=function(e,t){!t||s.hasChanged()&&!u()||e(t,function(e){if(o(!0),"string"==typeof t){a.val()!==t&&a.val(t);var n=r.createEmbedUrl(window.location,t);$("#embed_link").html('Use <a href="'+n+'">'+n+"</a> to open directly")}else a.val(""),$("#embed_link").html("");alertify.success('Loaded template "'+e+'" successfully')},function(e,t,n){s.setData('{"Error": "Unable to load template '+e+" because of "+t+'" }',o),alertify.error('Unable to load template "'+e+'" because of '+t),console.log(n)})};$.ajax({url:"styles/main.cycss",type:"GET",dataType:"text",success:function(e){s.changeStyle(e)}});var l=function(){s.refreshGraph(),$("#embed_link").toggle(!s.hasChanged()),t=void 0};i.setOption("lint",{onUpdateLinting:function(e){!s||e&&0!==e.length||(t&&window.clearTimeout(t),t=window.setTimeout(l,300))}}),n[0].addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),n[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),c(s.fromFile,e.dataTransfer.files[0])},!1);var f=!1,p=0,d=function(){var e=a.val();return a[0].checkValidity()?(a.hide(),e):void 0};$("#remote_input").keypress(function(e){return 13===e.which?(c(s.fromURL,d()),!1):void 0}),$("#open_template").click(function(e){e.preventDefault(),$("#template_input").click()}),$("#template_input").change(function(e){c(s.fromFile,e.target.files[0])}),$("#open_url").click(function(e){e.preventDefault(),a.is(":visible")?c(s.fromURL,d()):a.show()}),$("#save_template").click(function(e){return e.preventDefault(),saveAs(new Blob([s.text(2)],{type:"text/plain;charset=utf-8"}),s.description()+".json"),!1}),$("#save_graph").click(function(e){e.preventDefault();var t=window.open("savegraph.html");return t.onload=function(){t.document.getElementById("graphPNG").src=s.base64Image()},!1}),$("#graph_layout").change(function(){s.setLayout($("#graph_layout").val())});var g=$("#container"),h=$("#editor_pane");$("#border").on("mousedown",function(e){f=!0,p=e.clientX}),$(document).on("mousemove",function(e){if(f){var t=g.width()-(e.clientX-g.offset().left);n.css("right",t),h.css("width",t)}}).on("mouseup",function(){f&&s.fitGraph(),f=!1}),$(document).ready(function(){o(),r.parser(window.location.search,{onTemplate:function(e){c(s.fromURL,e)}}),window.addEventListener("beforeunload",u)})}()},{"./queryparser":4,"./template":5}],3:[function(e,t,n){n.findEdges=function r(e,t){"use strict";var n=[];if(e instanceof Array)e.forEach(function(e){n.push(r(e,t||""))});else if("object"==typeof e)if(1===Object.keys(e).length){var a=Object.keys(e)[0];if("Ref"===a&&"string"==typeof e[a])n.push({label:t||"",toResource:e[a],toProperty:t||""});else if("Fn::Join"===a&&e[a]instanceof Array)e[a][1].forEach(function(t){n.push(r(t,e[a][1].join(e[a][0])))});else if("Fn::GetAtt"===a&&e[a]instanceof Array)n.push({label:t,toResource:e[a][0],toProperty:e[a][1]});else for(var o in e)n.push(r(e[o],o))}else for(var i in e)n.push(r(e[i],i));return[].concat.apply([],n)}},{}],4:[function(e,t,n){n.parser=function(e,t){"use strict";if(e){var n=new URI(e).search(!0);n.CFTemplateURL&&t.onTemplate&&t.onTemplate(n.CFTemplateURL)}},n.createEmbedUrl=function(e,t){"use strict";return new URI(e).search(function(e){e.CFTemplateURL=t})}},{}],5:[function(e,t,n){n.template=function(t){"use strict";var n,r,a,o=t.editor,i=e("./collectdata"),s=t.graphContainer,u=t.jsonproxy,c=t.cytolib||cytoscape,l="grid",f={grid:{name:"grid",fit:!0,condense:!0,cols:4},breadthfirst:{name:"breadthfirst",fit:!0,directed:!1,avoidOverlap:!0,spacingFactor:.25},circle:{name:"circle",fit:!0,padding:10,radius:400,avoidOverlap:!1,startAngle:Math.PI},concentric:{name:"concentric",fit:!0,padding:10,avoidOverlap:!1,startAngle:Math.PI}},p=function(e){return f[e]||{name:e,fit:!0,animate:!1}},d=function(e){l=e,n&&n.layout(p(e))};if(!o||!o.getValue)throw"editor unavailable or doesn't support getValue";if(!c)throw"graphing library Cytoscape unavailable";var g=function(){return JSON.parse(o.getValue())},h=function(e){return e?JSON.stringify(g(),null,e):o.getValue()},m=function(e){r=e,n&&n.style(r)},v=function(e,t){if(!t&&!s)throw"No container available to show data";n=c({container:t||s,elements:e,style:r,layout:p(l)}),n.boxSelectionEnabled(!0),n.on("style","node",function(e){var t=e.cyTarget,n="hi";if("function"==typeof t.css){var r=t.css("background-image");r&&r.match(/unknown\.png/)&&console.log("WARN using unknown.png, because no image available for "+n)}})},y=function(e,t,n){if(e)try{var r="string"==typeof e?e:JSON.stringify(e,null,2),s="object"==typeof e?e:JSON.parse(e);o.setValue(r),a=h(),v(i.collectCyData(s)),t&&t()}catch(u){n&&n("Error processing data as JSON",u)}else n&&n("No data")},b=function(e,t,n){var r=new FileReader;r.onload=function(){y(r.result,function(){t&&t(e.name)},function(t,r){n&&n(e.name,t,r)})};try{r.readAsText(e)}catch(a){n&&n(e.name,a)}},w=function(){v(i.collectCyData(g()))},C=function(){var e="template";try{e=g().Description}catch(t){}return e},E=function(){return n?(n.center(),n.fit(),n.png({full:!1})):void 0},T=function(e,t,n){if(!u)throw"No jsonproxy available to request URLs";e&&u({url:e,corsSupport:!0,success:function(n){y(n),t&&t(e)},error:function(t,r){var a;"parsererror"===r?(o.setValue(t.responseText),a="Unable to parse the result as valid JSON"):a="Unable to load: status "+t.status+" "+t.statusText,n&&n(e,a,t,r)}})},S=function(){n&&n.fit()},R=function(){var e=a===h();return a?!e:!1};return{setData:y,fromFile:b,fromURL:T,refreshGraph:w,setLayout:d,base64Image:E,description:C,changeStyle:m,fitGraph:S,getGraph:function(){return n},text:h,json:g,hasChanged:R,initialData:a}}},{"./collectdata":1}]},{},[2]);
//# sourceMappingURL=edit.bundle.js.map
