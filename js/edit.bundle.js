!function e(t,n,r){function a(i,u){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require;if(!u&&c)return c(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return a(n?n:e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,n){var r=e("./findedges").findEdges;n.collectCyData=function(e){"use strict";var t={},n=[],a={"AWS::EC2::SecurityGroupIngress":function(e){if("GroupId"===e.data.title);else if("SourceSecurityGroupId"===e.data.title){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"AWS::EC2::SecurityGroupEgress":function(e){if("DestinationSecurityGroupId"===e.data.title);else if("GroupId"===e.data.title){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"default":function(e,n,r){return r&&"AWS::EC2::SecurityGroup"===r.type&&"AWS::EC2::SecurityGroup"!==n.type?(t[e.data.source].data.parent=e.data.target,!1):!0},get:function(e){return this[e]||this["default"]}},o={nodes:[],edges:[]},i=0,u=function(e){n.push({data:{id:"e"+i++,source:this,target:e.toResource,title:e.label,targetProperty:e.toProperty}})};for(var c in e.Resources){var s=e.Resources[c],l=s.Type.toLowerCase().replace(/::/g,"-"),f={data:{id:c,CFType:s.Type,nodeClass:l},classes:l,type:s.Type};r(s.Properties).forEach(u,c),t[c]=f,o.nodes.push(f)}return o.edges=n.filter(function(e){var n=t[e.data.source],r=t[e.data.target],o=a.get(n.type);return e&&n&&r&&o(e,n,r)}),o}},{"./findedges":3}],2:[function(e,t,n){!function(){"use strict";var t,n=$("#graph_area"),r=e("./queryparser"),a=$("#remote_input"),o=function(e){n.css("background-image",e?"":'url("images/aws-cloudformation-template.svg")')},i=new CodeMirror(document.getElementById("editor"),{value:"{}",lineNumbers:!0,mode:"application/json",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"]});i.setSize("100%","800px");var u=e("./template").template({editor:{setValue:function(e){i.getDoc().setValue(e)},getValue:function(){return i.getDoc().getValue()}},cytolib:cytoscape,graphContainer:n[0],jsonproxy:$.jsonp});window.getTemplate=function(){return u};var c=function(e){return u.hasChanged()?e&&"beforeunload"===e.type?(e.returnValue="The current template has unsaved changes.","The current template has unsaved changes."):window.confirm("The current template has unsaved changes. Continue loading?"):void 0},s=function(e,t){!t||u.hasChanged()&&!c()||e(t,function(e){if(o(!0),"string"==typeof t){a.val()!==t&&a.val(t);var n=r.createEmbedUrl(window.location,t);$("#embed_link").html('Use <a href="'+n+'">'+n+"</a> to open directly")}else a.val(""),$("#embed_link").html("");alertify.success('Loaded template "'+e+'" successfully')},function(e,t,n){u.setData('{"Error": "Unable to load template '+e+" because of "+t+'" }',o),alertify.error('Unable to load template "'+e+'" because of '+t),console.log(n)})};$.ajax({url:"styles/main.cycss",type:"GET",dataType:"text",success:function(e){u.changeStyle(e)}});var l=function(){u.refreshGraph(),$("#embed_link").toggle(!u.hasChanged()),t=void 0};i.setOption("lint",{onUpdateLinting:function(e){!u||e&&0!==e.length||(t&&window.clearTimeout(t),t=window.setTimeout(l,300))}}),n[0].addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),n[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),s(u.fromFile,e.dataTransfer.files[0])},!1);var f=!1,d=0,p=function(){var e=a.val();return a[0].checkValidity()?(a.hide(),e):void 0};$("#remote_input").keypress(function(e){return 13===e.which?(s(u.fromURL,p()),!1):void 0}),$("#open_template").click(function(e){e.preventDefault(),$("#template_input").click()}),$("#template_input").change(function(e){s(u.fromFile,e.target.files[0])}),$("#open_url").click(function(e){e.preventDefault(),a.is(":visible")?s(u.fromURL,p()):a.show()}),$("#save_template").click(function(e){return e.preventDefault(),saveAs(new Blob([u.text(2)],{type:"text/plain;charset=utf-8"}),u.description()+".json"),!1}),$("#save_graph").click(function(e){e.preventDefault();var t=window.open("savegraph.html");return t.onload=function(){t.document.getElementById("graphPNG").src=u.base64Image()},!1}),$("#graph_layout").change(function(){u.setLayout($("#graph_layout").val())});var g=$("#container"),h=$("#editor_pane");$("#border").on("mousedown",function(e){f=!0,d=e.clientX}),$(document).on("mousemove",function(e){if(f){var t=g.width()-(e.clientX-g.offset().left);n.css("right",t),h.css("width",t)}}).on("mouseup",function(){f&&u.fitGraph(),f=!1}),$(document).ready(function(){o(),r.parser(window.location.search,{onTemplate:function(e){s(u.fromURL,e)}}),window.addEventListener("beforeunload",c)})}()},{"./queryparser":4,"./template":5}],3:[function(e,t,n){n.findEdges=function r(e,t){"use strict";var n=[];if(e instanceof Array)e.forEach(function(e){n.push(r(e,t||""))});else if("object"==typeof e)if(1===Object.keys(e).length){var a=Object.keys(e)[0];if("Ref"===a&&"string"==typeof e[a])n.push({label:t||"",toResource:e[a],toProperty:t||""});else if("Fn::Join"===a&&e[a]instanceof Array)e[a][1].forEach(function(t){n.push(r(t,e[a][1].join(e[a][0])))});else if("Fn::GetAtt"===a&&e[a]instanceof Array)n.push({label:t,toResource:e[a][0],toProperty:e[a][1]});else for(var o in e)n.push(r(e[o],o))}else for(var i in e)n.push(r(e[i],i));return[].concat.apply([],n)}},{}],4:[function(e,t,n){n.parser=function(e,t){"use strict";if(e){var n=new URI(e).search(!0);n.CFTemplateURL&&t.onTemplate&&t.onTemplate(n.CFTemplateURL)}},n.createEmbedUrl=function(e,t){"use strict";return new URI(e).search(function(e){e.CFTemplateURL=t})}},{}],5:[function(e,t,n){n.template=function(t){"use strict";var n,r,a,o=t.editor,i=e("./collectdata"),u=t.graphContainer,c=t.jsonproxy,s=t.cytolib||cytoscape,l="grid",f={grid:{name:"grid",fit:!0,condense:!0,cols:4},breadthfirst:{name:"breadthfirst",fit:!0,directed:!1,avoidOverlap:!0,spacingFactor:.25},circle:{name:"circle",fit:!0,padding:10,radius:400,avoidOverlap:!1,startAngle:Math.PI},concentric:{name:"concentric",fit:!0,padding:10,avoidOverlap:!1,startAngle:Math.PI}},d=function(e){return f[e]||{name:e,fit:!0,animate:!1}},p=function(e){l=e,n&&n.layout(d(e))};if(!o||!o.getValue)throw"editor unavailable or doesn't support getValue";if(!s)throw"graphing library Cytoscape unavailable";var g=function(){return JSON.parse(o.getValue())},h=function(e){return e?JSON.stringify(g(),null,e):o.getValue()},y=function(e){r=e,n&&n.style(r)},v=function(e,t){if(!t&&!u)throw"No container available to show data";n=s({container:t||u,elements:e,style:r,layout:d(l)}),n.boxSelectionEnabled(!0),n.on("style","node",function(e){var t=e.cyTarget,n=t.data("CFType");t.css("background-image").match(/unknown\.png/)&&console.log("WARN using unknown.png, because no image available for "+n)})},m=function(e,t,n){if(e)try{var r="string"==typeof e?e:JSON.stringify(e,null,2),u="object"==typeof e?e:JSON.parse(e);o.setValue(r),a=h(),v(i.collectCyData(u)),t&&t()}catch(c){n&&n("Error processing data as JSON",c)}else n&&n("No data")},b=function(e,t,n){var r=new FileReader;r.onload=function(){m(r.result,function(){t&&t(e.name)},function(t,r){n&&n(e.name,t,r)})};try{r.readAsText(e)}catch(a){n&&n(e.name,a)}},w=function(){v(i.collectCyData(g()))},C=function(){var e="template";try{e=g().Description}catch(t){}return e},T=function(){return n?(n.center(),n.fit(),n.png({full:!1})):void 0},E=function(e,t,n){if(!c)throw"No jsonproxy available to request URLs";e&&c({url:e,corsSupport:!0,success:function(n){m(n),t&&t(e)},error:function(t,r){var a;"parsererror"===r?(o.setValue(t.responseText),a="Unable to parse the result as valid JSON"):a="Unable to load: status "+t.status+" "+t.statusText,n&&n(e,a,t,r)}})},S=function(){n&&n.fit()},$=function(){var e=a===h();return a?!e:!1};return{setData:m,fromFile:b,fromURL:E,refreshGraph:w,setLayout:p,base64Image:T,description:C,changeStyle:y,fitGraph:S,getGraph:function(){return n},text:h,json:g,hasChanged:$,initialData:a}}},{"./collectdata":1}]},{},[2]);
//# sourceMappingURL=edit.bundle.js.map
