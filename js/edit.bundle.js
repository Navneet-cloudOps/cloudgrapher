!function e(t,r,n){function a(i,s){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!s&&u)return u(i,!0);if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[i]={exports:{}};t[i][0].call(l.exports,function(e){var r=t[i][1][e];return a(r?r:e)},l,l.exports,e,t,r,n)}return r[i].exports}for(var o="function"==typeof require&&require,i=0;i<n.length;i++)a(n[i]);return a}({1:[function(e,t,r){var n=e("./findedges").findEdges;r.graphOptions={nodes:{brokenImage:"images/unknown.png"},edges:{style:"arrow","color.highlight":"red"},stabilize:!0,zoomExtentOnStabilize:!0},r.collectData=function(e){"use strict";var t={nodes:[],edges:[]},r=[],a=[],o=function(e,t){a.push({from:i,to:e,title:t})};for(var i in e.Resources){var s=e.Resources[i],u=s.Properties,c=s.Type.toLowerCase().replace(/::/g,"-");r.push(i),t.nodes.push({id:i,label:i,group:c,shape:"image",image:"images/"+c+".png"}),n(u,o)}return t.edges=a.filter(function(e){return e&&r.indexOf(e.to)>=0}),t},r.collectCyData=function(e){"use strict";var t={"AWS::EC2::SecurityGroupIngress":function(e){if("GroupId"===e.data.resource);else if("SourceSecurityGroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"AWS::EC2::SecurityGroupEgress":function(e){if("DestinationSecurityGroupId"===e.data.resource);else if("GroupId"===e.data.resource){var t=e.data.source;e.data.source=e.data.target,e.data.target=t}return!0},"default":function(e,t,r){return r&&"AWS::EC2::SecurityGroup"===r.type&&"AWS::EC2::SecurityGroup"!==t.type?(i[e.data.source].data.parent=e.data.target,!1):!0},get:function(e){return this[e]||this["default"]}},r={nodes:[],edges:[]},a=0,o=function(e,t,r){s.push({data:{id:"e"+a++,source:u,target:e,title:t,resource:r}})},i={},s=[];for(var u in e.Resources){var c=e.Resources[u],l={data:{id:u},classes:c.Type.toLowerCase().replace(/::/g,"-"),type:c.Type};n(c.Properties,o),i[u]=l,r.nodes.push(l)}return r.edges=s.filter(function(e){var r=i[e.data.source],n=i[e.data.target],a=t.get(r.type);return e&&r&&n&&a(e,r,n)}),r}},{"./findedges":3}],2:[function(e,t,r){!function(){"use strict";var t=new CodeMirror(document.getElementById("editor"),{value:"{}",lineNumbers:!0,mode:"application/json",foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:{onUpdateLinting:function(e){!n||e&&0!==e.length||(n.refreshGraph(),$("#embed_link").toggle(!n.hasChanged()))}}});t.setSize("100%","800px");var r=$("#graph_area");r.css("background-image",'url("images/aws-cloudformation-template.svg")'),r[0].addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),r[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),u(n.fromFile,e.dataTransfer.files[0])},!1);var n=e("./template").template({editor:{setValue:function(e){t.getDoc().setValue(e)},getValue:function(){return t.getDoc().getValue()}},cytolib:cytoscape,graphContainer:r[0],jsonproxy:$.jsonp});$.ajax({url:"styles/main.cycss",type:"GET",dataType:"text",success:function(e){n.changeStyle(e)}});var a=!1,o=0,i=$("#remote_input");$("#remote_input").keypress(function(e){return 13===e.which?(u(n.fromURL,s()),!1):void 0});var s=function(){var e=i.val();return i[0].checkValidity()?(i.hide(),e):void 0},u=function(e,t){t&&e(t,function(e){if(r.css("background-image",""),"string"==typeof t){i.val()!==t&&i.val(t);var n=f.createEmbedUrl(window.location,t);$("#embed_link").html('Use <a href="'+n+'">'+n+"</a> to open directly")}else $("#embed_link > a").remove();alertify.success('Loaded template "'+e+'" successfully')},function(e,t,r){alertify.error('Unable to load template "'+e+'" because of '+t),console.log(r)})};$("#open_template").click(function(e){e.preventDefault(),$("#template_input").click()}),$("#template_input").change(function(e){u(n.fromFile,e.target.files[0])}),$("#open_url").click(function(e){e.preventDefault(),i.is(":visible")?u(n.fromURL,s()):i.show()}),$("#save_template").click(function(e){return e.preventDefault(),saveAs(new Blob([n.text(2)],{type:"text/plain;charset=utf-8"}),n.description()+".json"),!1}),$("#save_graph").click(function(e){e.preventDefault();var t=window.open("savegraph.html");return t.onload=function(){t.document.getElementById("graphPNG").src=n.base64Image()},!1}),$("#graph_layout").change(function(){n.setLayout($("#graph_layout").val())});var c=$("#container"),l=$("#editor_pane");$("#border").on("mousedown",function(e){a=!0,o=e.clientX}),$(document).on("mousemove",function(e){if(a){var t=c.width()-(e.clientX-c.offset().left);r.css("right",t),l.css("width",t)}}).on("mouseup",function(){a&&n.fitGraph(),a=!1});var f=e("./queryparser");$(document).ready(function(){f.parser(window.location.search,{onTemplate:function(e){u(n.fromURL,e)}})})}()},{"./queryparser":4,"./template":5}],3:[function(e,t,r){r.findEdges=function n(e,t,r){"use strict";if(e instanceof Array)e.forEach(function(e){n(e,t,r||"")});else if("object"==typeof e)if(1===Object.keys(e).length){var a=Object.keys(e)[0];if("Ref"===a&&"string"==typeof e[a])t(e[a],r||"",r);else if("Fn::Join"===a&&e[a]instanceof Array)e[a][1].forEach(function(r){n(r,t,e[a][1].join(e[a][0]))});else if("Fn::GetAtt"===a&&e[a]instanceof Array)t(e[a][0],e[a][1],r);else for(var o in e)n(e[o],t,o)}else for(var i in e)n(e[i],t,i)}},{}],4:[function(e,t,r){r.parser=function(e,t){"use strict";if(e){var r=new URI(e).search(!0);r.CFTemplateURL&&t.onTemplate&&t.onTemplate(r.CFTemplateURL)}},r.createEmbedUrl=function(e,t){"use strict";return new URI(e).search(function(e){e.CFTemplateURL=t})}},{}],5:[function(e,t,r){r.template=function(t){"use strict";var r,n,a,o=t.editor,i=e("./collectdata"),s=t.graphContainer,u=t.jsonproxy,c=t.cytolib||cytoscape,l="cose";if(!o||!o.getValue)throw"editor unavailable or doesn't support getValue";if(!c)throw"graphing library Cytoscape unavailable";var f=function(e){n=e,r&&r.style(n)},p=function(e,t,r){var n=new FileReader;n.onload=function(){d(n.result,function(){t&&t(e.name)},function(t,n){r&&r(e.name,t,n)})};try{n.readAsText(e)}catch(a){r&&r(e.name,a)}},d=function(e,t,r){if(e)try{var n="string"==typeof e?e:JSON.stringify(e,null,2),s="object"==typeof e?e:JSON.parse(e);o.setValue(n),a=S(),m(i.collectCyData(s)),t&&t()}catch(u){r&&r("Error processing data as JSON",u)}else r&&r("No data")},g=function(){m(i.collectCyData(h()))},m=function(e,t){if(!t&&!s)throw"No container available to show data";r=c({container:t||s,elements:e,style:n,layout:{name:l,padding:5}}),r.boxSelectionEnabled(!0)},y=function(){var e="template";try{e=h().Description}catch(t){}return e},v=function(){return r?(r.center(),r.fit(),r.png({full:!1})):void 0},h=function(){return JSON.parse(o.getValue())},b=function(e){l=e,r&&r.layout({name:e})},w=function(e,t,r){if(!u)throw"No jsonproxy available to request URLs";e&&u({url:e,corsSupport:!0,success:function(r){d(r),t&&t(e)},error:function(t,n){var a;"parsererror"===n?(o.setValue(t.responseText),a="Unable to parse the result as valid JSON"):a="Unable to load: status "+t.status+" "+t.statusText,r&&r(e,a,t,n)}})},S=function(e){return e?JSON.stringify(h(),null,e):o.getValue()},C=function(){r&&r.fit()},E=function(){var e=a===S();return!e};return{setData:d,fromFile:p,fromURL:w,refreshGraph:g,setLayout:b,base64Image:v,description:y,changeStyle:f,fitGraph:C,text:S,json:h,hasChanged:E,initialData:a}}},{"./collectdata":1}]},{},[2]);
//# sourceMappingURL=edit.bundle.js.map
